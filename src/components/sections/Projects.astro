---
// ProjectsSection.astro
const categories = ["Todos", "Residencial", "Comercial", "Bioclimático"];

const projects = [
  {
    id: 1,
    title: "Casa FQ",
    category: "Residencial",
    location: "Guanacaste, Costa Rica",
    year: "2024",
    image: "/assets/project-modern-house.png",
    description: "Residencia contemporánea con acabados de alta gama y diseño minimalista.",
  },
  {
    id: 2,
    title: "Loft Urbano",
    category: "Residencial",
    location: "San José, Costa Rica",
    year: "2023",
    image: "/assets/project-interior.png",
    description: "Interior moderno con integración de vegetación y espacios abiertos.",
  },
  {
    id: 3,
    title: "Eco Lodge Tropical",
    category: "Bioclimático",
    location: "Nicoya, Costa Rica",
    year: "2023",
    image: "/assets/project-cabin-interior.png",
    description: "Hospedaje sostenible construido con materiales locales y técnicas tradicionales.",
  },
  {
    id: 4,
    title: "Cabaña Palmera",
    category: "Bioclimático",
    location: "Nosara, Costa Rica",
    year: "2024",
    image: "/assets/project-tropical-cabin.png",
    description: "Arquitectura tropical que se integra armónicamente con su entorno natural.",
  },
  {
    id: 5,
    title: "Casa Enredadera",
    category: "Residencial",
    location: "Tamarindo, Costa Rica",
    year: "2023",
    image: "/assets/project-spiral-stairs.png",
    description: "Vivienda con escalera escultórica y diseño biofílico.",
  },
  {
    id: 6,
    title: "Villa Horizonte",
    category: "Comercial",
    location: "Liberia, Costa Rica",
    year: "2024",
    image: "/assets/project-white-house.png",
    description: "Proyecto mixto con espacios comerciales y residenciales de alta categoría.",
  },
];
---

<section id="/#proyectos" class="section-padding bg-background">
  <div class="container-corporate">
    <!-- Header -->
    <div class="projects-header text-center max-w-3xl mx-auto mb-12">
      <span class="inline-block text-primary font-medium tracking-widest text-sm uppercase mb-4">
        Portafolio
      </span>
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-display font-semibold text-foreground leading-tight mb-6">
        Proyectos que definen nuestra trayectoria
      </h2>
      <p class="text-muted-foreground leading-relaxed">
        Cada proyecto es una oportunidad para crear espacios únicos que trascienden 
        el tiempo y mejoran la vida de quienes los habitan.
      </p>
    </div>

    <!-- Category Filter -->
    <div class="projects-filter flex flex-wrap justify-center gap-4 mb-12">
      {categories.map((category) => (
        <button
          data-category={category}
          class={`category-btn px-6 py-2 text-sm font-medium rounded-sm transition-all duration-300 ${
            category === "Todos"
              ? "bg-primary text-primary-foreground"
              : "bg-secondary text-foreground hover:bg-accent"
          }`}
        >
          {category}
        </button>
      ))}
    </div>

    <!-- Projects Grid -->
    <div class="projects-grid grid md:grid-cols-2 lg:grid-cols-3 gap-8">
      {projects.map((project, index) => (
        <div
          class="project-item group cursor-pointer"
          data-category={project.category}
          data-delay={0.1 * index}
        >
          <div class="project-card h-80 mb-4">
            <img
              src={project.image}
              alt={project.title}
              class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
            />
            <div class="absolute inset-0 flex flex-col justify-end p-6 z-10">
              <span class="text-cta text-sm font-medium mb-2">
                {project.category}
              </span>
              <h3 class="text-xl font-display font-semibold text-corporate-dark-foreground mb-1">
                {project.title}
              </h3>
              <p class="text-corporate-dark-foreground/70 text-sm">
                {project.location} · {project.year}
              </p>
            </div>
            <div class="absolute top-4 right-4 w-10 h-10 bg-cta rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-10">
              <svg class="w-5 h-5 text-cta-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 17L17 7M17 7H7m10 0v10"/>
              </svg>
            </div>
          </div>
          <p class="text-muted-foreground text-sm leading-relaxed">
            {project.description}
          </p>
        </div>
      ))}
    </div>

    <!-- CTA -->
    <div class="projects-cta text-center mt-16">
      <a href="#contacto" class="btn-outline-corporate rounded-sm inline-block">
        Ver Todos los Proyectos
      </a>
    </div>
  </div>
</section>

<style>
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeInDown {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .projects-header,
  .projects-filter,
  .projects-cta {
    opacity: 0;
  }

  .projects-header.animate-in {
    animation: fadeInUp 0.6s ease-out forwards;
  }

  .projects-filter.animate-in {
    animation: fadeInDown 0.6s ease-out 0.2s forwards;
  }

  .project-item {
    opacity: 0;
  }

  .project-item.animate-in {
    animation: fadeInUp 0.6s ease-out forwards;
  }

  .project-item.hide {
    display: none;
  }

  .projects-cta.animate-in {
    animation: fadeInUp 0.6s ease-out 0.6s forwards;
  }
</style>

<script>
  // Intersection Observer for animations
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '-100px',
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.add('animate-in');
      }
    });
  }, observerOptions);

  // Observe sections
  const header = document.querySelector('.projects-header');
  const filter = document.querySelector('.projects-filter');
  const cta = document.querySelector('.projects-cta');

  if (header) observer.observe(header);
  if (filter) observer.observe(filter);
  if (cta) observer.observe(cta);

  // Animate project items with stagger
  const projectItems = document.querySelectorAll('.project-item');
  projectItems.forEach((item) => {
    const delay = parseFloat(item.getAttribute('data-delay') || '0');
    (item as HTMLElement).style.animationDelay = `${delay}s`;
    observer.observe(item);
  });

  // Category filtering
  let activeCategory = 'Todos';
  const categoryButtons = document.querySelectorAll('.category-btn');

  categoryButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      const category = btn.getAttribute('data-category') || 'Todos';
      
      // Update active state
      categoryButtons.forEach((b) => {
        b.classList.remove('bg-primary', 'text-primary-foreground');
        b.classList.add('bg-secondary', 'text-foreground', 'hover:bg-accent');
      });
      btn.classList.remove('bg-secondary', 'text-foreground', 'hover:bg-accent');
      btn.classList.add('bg-primary', 'text-primary-foreground');
      
      activeCategory = category;
      
      // Filter projects
      projectItems.forEach((item) => {
        const itemCategory = item.getAttribute('data-category');
        
        if (activeCategory === 'Todos' || itemCategory === activeCategory) {
          item.classList.remove('hide');
          // Re-trigger animation
          item.classList.remove('animate-in');
          void (item as HTMLElement).offsetWidth; // Trigger reflow
          item.classList.add('animate-in');
        } else {
          item.classList.add('hide');
        }
      });
    });
  });
</script>